# Reiven.io (Cloudflare)

Transparent ecnryption for the masses. Browser-side encrypted file sharing proof of concept using Cloudflare Workers + R2 + D1.

## Architecture

- Frontend static assets served by Worker `assets` binding
- Browser encryption/decryption with Argon2id + AES-256-GCM
- Multipart upload from browser to Worker API, then into R2 multipart objects
- Encrypted blob storage in R2
- File metadata + delete token + expiry in D1
- Per-file unique 8-digit access code (`12-34-56-78`) for code-based retrieval
- Delete/download links generated by Worker API

## Prerequisites

- Cloudflare account (free tier is enough for PoC)
- `npm` and `wrangler`

## Setup

1. Install dependencies:

```bash
npm install
```

2. Create D1 database:

```bash
wrangler d1 create encrypted-share-db
```

3. Update `/wrangler.toml` with the real `database_id` from step 2.

4. Create R2 bucket:

```bash
wrangler r2 bucket create encrypted-share-files
```

5. Run DB migration:

```bash
npm run db:migrate:remote
```

## Local development

```bash
npm run dev
```

## Deploy

```bash
npm run deploy
```

## API

- `POST /api/upload/init` (JSON: `originalName`, `size`) -> returns `uploadId`, `partSizeBytes`
- `POST /api/upload/part?uploadId=<id>&partNumber=<n>` (binary chunk body) -> returns `etag`
- `POST /api/upload/complete` (JSON: `uploadId`, `size`, `parts[]`) -> returns links
- `POST /api/upload/abort` (JSON: `uploadId`)
- `GET /api/file/:id/info`
- `GET /api/file/code/:code/info` (code can be sent with or without dashes)
- `GET /api/file/:id/download`
- `DELETE /api/file/:id?token=<deleteToken>`
- `GET /delete/:id/:token`

## Environment variables (optional)

- `FILE_TTL_HOURS` (default `24`)
- `MAX_FILE_SIZE_MB` (default `2048`)

## Shared encryption config

Encryption constants are defined in a single shared file:

- `shared/encryption-config.mjs`

The web app loads this via `GET /api/encryption-config`, and the CLI imports the same module directly.

## Security note

This is a PoC. Before production use, add abuse controls, monitoring/alerts, signed URL policy, malware scanning, legal/compliance review, and stronger password policy UX.

- Multipart chunk size default is 50MB to reduce per-part roundtrip pauses.
